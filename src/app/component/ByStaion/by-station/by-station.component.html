<div class="container mt-4">
  <app-breadcrumb
    [lineName]="selectedLine?.line_name"
    [stationName]="selectedStation?.name"
    (goHome)="onBackToHome()"
    (backToLine)="onBackToLine()">
  </app-breadcrumb>

  <div class="metro-search" *ngIf="!selectedLine">
    <input
      type="text"
      placeholder="Search by station..."
      [(ngModel)]="searchQuery"
    />
  </div>

  <div *ngIf="!selectedLine" class="metro-lines-scroll">
    <div
      *ngFor="let line of filteredLineFilter()"
      class="metro-line mb-3 p-3 rounded shadow-sm"
      [ngStyle]="{ 'border-left': '5px solid ' + getLineColor(line.line_name) }"
    >
      <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
        <div class="metro-line-name fw-bold">
          <span [style.color]="getLineColor(line.line_name)">◙</span>
          <ng-container *ngIf="line.status === 'AC'; else plainLineName">
            <a href="#" (click)="onLineClick(line)" class="text-decoration-none text-dark">
              {{ line.line_name }}
            </a>
          </ng-container>
          <ng-template #plainLineName>
            {{ line.line_name }}
          </ng-template>
        </div>

        <div class="metro-line-status mt-2 mt-md-0" [ngClass]="getStatusColor(line.status)">
          {{ getFullStatus(line.status) }}
        </div>

        <div class="metro-line-terminals text-primary mt-2 mt-md-0">
          <ng-container *ngIf="searchedStation && hasMatchingStation(line.stations); else defaultTerminals">
          <ng-container *ngFor="let matchStation of getMatchingStations(line)">
            <ng-container *ngIf="getDirection(line.stations, matchStation, 'forward') as forward">
              <div *ngIf="forward && forward !== matchStation">
                ➡️ Towards: {{ matchStation }} → {{ forward }}
              </div>
            </ng-container>
            <ng-container *ngIf="getDirection(line.stations, matchStation, 'backward') as backward">
              <div *ngIf="backward && backward !== matchStation">
                ⬅️ Towards: {{ matchStation }} → {{ backward }}
              </div>
            </ng-container>
          </ng-container>
        </ng-container>

        <ng-template #defaultTerminals>
          ({{ line.stations[0] }} ⇄ {{ line.stations[line.stations.length - 1] }})
        </ng-template>

        </div>
      </div>
    </div>
  </div>

  <app-metro-line-detail
    *ngIf="selectedLine && !selectedStation"
    [line]="selectedLine"
    (stationClick)="onStationClick($event)">
  </app-metro-line-detail>

  <app-metro-station-detail
    *ngIf="selectedStation"
    [station]="selectedStation"
    [lineName]="selectedLine.line_name">
  </app-metro-station-detail>
</div>
